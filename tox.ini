[tox]
envlist = py39, py310, pre-commit

[testenv]
install_command = python -m pip install -f https://release.colossalai.org --extra-index-url https://download.pytorch.org/whl/cu116 {opts} {packages}
deps =
    # We don't just install requirements.txt here because tox doesn't use
    # the -f line in requirements.txt.
    colossalai==0.1.12+torch1.12cu11.3
    h5py
    tokenizers==0.13.2
    torch>=1.12
    transformers==4.25.1
    -rrequirements-dev.txt
commands =
    coverage erase
    coverage run -m pytest {posargs}
    coverage report

[testenv:pre-commit]
skip_install = true
deps = pre-commit
commands = pre-commit run --all-files --show-diff-on-failure
